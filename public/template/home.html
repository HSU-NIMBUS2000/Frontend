<!DOCTYPE HTML>
<html>

<head>
    <title>Astral by HTML5 UP</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css" />
    </noscript>

    <style>
        ul {
            list-style-type: none;
        }
    </style>
</head>

<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Nav -->
        <nav id="nav">
            <a href="#" class="icon solid fa-list"><span>환자목록</span></a>
        </nav>

        <!-- Main -->
        <div id="main">

            <!-- Me -->
            <article id="home" class="panel intro" >
                <header>
                    <ul id="patientList">
                        <!-- JavaScript에서 동적으로 추가 -->
                    </ul>

                    <script>
                        async function fetchPatientList() {
                            try {
                                const token = "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwidXNlcklkIjoiMSIsInJvbGVzIjpbIlJPTEVfRE9DVE9SIl0sImlhdCI6MTczMjUxNTU1OSwiZXhwIjoxNzMyNjAxOTU5fQ.mc3MI4eQwHe2C7FNA0cw7rl-Hf_TmvOJa4FkC3ym-os";

                                localStorage.setItem('doctorToken', token);


                                const response = await fetch('/api/patient/list', {
                                    method: 'GET',
                                    headers: {
                                        'Authorization': `Bearer ${token}`, // Authorization 헤더 추가
                                        'Content-Type': 'application/json'  // JSON 형식 명시
                                    }
                                });

                                if (!response.ok) {
                                    throw new Error(`Failed to fetch patient list: ${response.status}`);
                                }

                                const data = await response.json(); // JSON 데이터를 파싱
                                const listElement = document.getElementById('patientList');
                                console.log(data);

                                // 기존 리스트 초기화
                                listElement.innerHTML = '';

                                // 데이터를 반복하여 리스트 항목 생성
                                data.data.forEach(patient => {
                                    const listItem = document.createElement('li');
                                    listItem.textContent = patient.patientName; // API에서 제공된 데이터 속성 사용
                                    localStorage.setItem('patientId', patient.patientId);
                                    
                                    listItem.onclick = () => navigateToTemplate(patient); // 객체 전달    
                                    
                                    
                                    

                                    listElement.appendChild(listItem);
                                });
                            } catch (error) {
                                console.error('Error fetching patient list:', error);
                            }
                        }

                        // 페이지 로드 시 데이터 가져오기
                        window.onload = fetchPatientList;

                        function navigateToTemplate(patient) {
                            // 객체 데이터를 JSON 문자열로 인코딩하여 URL에 추가
                            const patientData = encodeURIComponent(JSON.stringify(patient));
                            window.location.href = `template.html?data=${patientData}`;
                        }
                    </script>
                </header>
            </article>

        </div>

        <!-- Scripts -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/browser.min.js"></script>
        <script src="assets/js/breakpoints.min.js"></script>
        <script src="assets/js/util.js"></script>
        <script src="assets/js/main.js"></script>

</body>

</html>